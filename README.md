# Git Merge Orchestrator 2.0

🚀 **智能Git大分叉分步合并工具** - 重构增强版

一个专门解决大型分支分叉协作合并问题的智能工具。通过智能任务分配、文件分组和进度追踪，将复杂的合并工作转化为可管理的团队协作流程。

## ✨ 核心特性

### 🎯 智能分组与分配
- **智能文件分组**: 按目录结构自动分组，每组最多5个文件，避免冲突集中
- **贡献者分析**: 基于Git历史分析文件贡献者，重点关注一年内活跃度
- **自动任务分配**: 优先分配给近期活跃且熟悉相关文件的开发者
- **备选分配策略**: 文件级→目录级→根目录级的层次化分配机制

### 🔄 协作与追踪
- **多人并行**: 支持团队成员同时处理不同文件组
- **进度可视化**: 实时显示分配状态、完成进度和负载分布
- **智能表格显示**: 自动调整列宽，支持完整组名显示模式
- **远程状态检测**: 自动检测远程分支状态，智能推断完成情况
- **批量操作**: 支持按负责人批量合并和状态管理

### 🛠️ 智能合并
- **差异化处理**: 区分新文件和已存在文件，采用不同合并策略
- **脚本生成**: 自动生成可执行的合并脚本，降低操作复杂度
- **错误恢复**: 完善的错误处理和回滚机制
- **冲突预览**: 提前预览合并冲突，制定解决策略

## 📁 项目结构

```
git-merge-orchestrator/
├── main.py                     # 主入口文件
├── git_merge_orchestrator.py   # 主控制器
├── config.py                   # 配置管理
├── core/                       # 核心业务模块
│   ├── git_operations.py       # Git操作管理
│   ├── contributor_analyzer.py # 贡献者分析
│   ├── task_assigner.py        # 任务分配管理
│   ├── merge_executor.py       # 合并执行器
│   └── plan_manager.py         # 合并计划管理
├── ui/                         # 用户界面模块
│   └── display_helper.py       # 显示格式化
├── utils/                      # 工具模块
│   └── file_helper.py          # 文件操作工具
└── README.md                   # 项目说明
```

## 🚀 快速开始

### 环境要求
- Python 3.7+
- Git 2.0+
- 在Git仓库目录下运行

### 基础使用

```bash
# 基础合并（默认每组5个文件）
python main.py feature/big-feature main

# 自定义每组文件数
python main.py feature/big-feature main --max-files 8

# 指定仓库路径
python main.py feature/big-feature main --repo /path/to/repo

# 查看帮助
python main.py --help
```

### 完整工作流程

1. **分析分支分叉**
   ```
   选择菜单：1. 分析分支分叉
   ```

2. **创建智能合并计划**
   ```
   选择菜单：2. 创建智能合并计划
   ```

3. **智能自动分配任务**
   ```
   选择菜单：3. 智能自动分配任务
   - 自动排除近3个月无提交的人员
   - 支持手动排除特定人员
   - 启用备选分配方案
   ```

4. **查看分配结果**
   ```
   选择菜单：9. 检查状态
   - a. 标准表格显示（智能列宽调整）
   - b. 完整组名显示（无截断显示）
   选择菜单：5. 查看贡献者分析
   ```

5. **执行合并操作**
   ```
   # 单组合并
   选择菜单：6. 合并指定组

   # 批量合并（按负责人）
   选择菜单：8. 合并指定负责人的所有任务
   ```

6. **状态管理**
   ```
   选择菜单：12. 完成状态管理
   - 标记组完成
   - 自动检查远程分支状态
   ```

7. **最终合并**
   ```
   选择菜单：13. 完成最终合并
   ```

## 🎯 高级功能

### 智能分配策略

工具采用多层次的智能分配策略：

1. **文件级分析** - 分析每个文件的主要贡献者
2. **活跃度过滤** - 自动排除近3个月无提交的人员
3. **负载均衡** - 限制每人最大任务数，避免工作量集中
4. **备选分配** - 当文件级分析无结果时，向上查找目录级贡献者

### 评分规则

```
综合得分 = 一年内提交数 × 3 + 历史总提交数 × 1
```

这个规则确保：
- 重点关注近期活跃的开发者
- 兼顾历史贡献，避免新人被忽略
- 提高合并质量和执行效率

### 分组策略

1. **目录优先** - 按顶级目录分组，保持相关性
2. **大小控制** - 每组最多5个文件，避免冲突集中
3. **递归拆分** - 大目录自动拆分为子组
4. **字母分组** - 根目录文件按首字母分组
5. **批量回退** - 异常时回退到简单批量分组

## 🎨 显示优化特性

### 智能表格显示
- **自动列宽调整**: 根据数据内容智能调整表格列宽
- **组名完整显示**: 提供完整组名显示模式，避免长名称截断
- **智能文本截断**: 当文本过长时，智能截断并添加省略号
- **中文字符支持**: 正确计算中文字符显示宽度，确保对齐

### 显示模式选择
**标准表格模式**:
- 紧凑的表格显示，适合概览
- 智能调整列宽，平衡可读性和屏幕空间

**完整组名模式**:
- 完整显示所有组名，无截断
- 详细的分配信息和状态说明
- 适合需要查看具体组名的场景

## 📊 使用场景

### 🏢 企业级开发团队
- 大型feature分支向main分支的合并
- 长期开发分支的定期同步
- 多团队协作的代码集成

### 🔧 开源项目维护
- 复杂PR的分治处理
- 大版本更新的渐进合并
- 贡献者协作管理

### 🚀 DevOps集成
- CI/CD流程中的智能合并
- 自动化分配和追踪
- 合并质量监控

## 🛡️ 安全特性

- **非破坏性操作** - 所有操作在独立分支进行
- **完整回滚机制** - 支持任意阶段的状态回滚
- **冲突预检测** - 提前发现潜在冲突
- **分支保护** - 原始分支始终保持安全

## 📈 性能优化

- **迭代算法** - 避免递归深度问题，处理超大型仓库
- **缓存机制** - 贡献者信息缓存，减少重复计算
- **批量操作** - 支持批量处理，提高操作效率
- **增量更新** - 只处理变更部分，节省资源

## 🐛 故障排除

### 常见问题

**Q: "Git命令执行失败"**
- 检查是否在Git仓库目录下
- 确认分支名称正确
- 检查Git版本是否支持

**Q: "无法确定主要贡献者"**
- 分支可能是全新创建的
- 文件可能没有足够的提交历史
- 启用备选分配方案

**Q: "合并脚本执行失败"**
- 检查文件权限
- 确认源分支和目标分支状态
- 查看生成的脚本内容

### 调试模式

```bash
# 启用详细日志
export GIT_MERGE_DEBUG=1
python main.py feature/big-feature main
```

## 🤝 参与贡献

欢迎提交Issue和Pull Request！

### 开发指南

1. Fork本仓库
2. 创建feature分支
3. 提交代码变更
4. 确保通过测试
5. 创建Pull Request

### 代码规范

- 使用中文注释和打印输出
- 函数名使用snake_case
- 完善的错误处理
- 丰富的emoji和格式化输出

## 📄 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 👥 作者

- **Howie** - 项目创建者和主要维护者

## 🙏 致谢

感谢所有使用本工具并提供反馈的开发者！

---

**⭐ 如果这个工具对你有帮助，请给个星星支持一下！**