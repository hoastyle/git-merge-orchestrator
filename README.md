# Git Merge Orchestrator 2.0

🚀 **智能Git大分叉分步合并工具** - DRY架构重构增强版

一个专门解决大型分支分叉协作合并问题的智能工具。通过智能任务分配、文件分组和进度追踪，将复杂的合并工作转化为可管理的团队协作流程。

## ✨ 版本2.0新特性

### 🚀 性能优化
- **涡轮增压自动分配**: 显著提升任务分配速度（提升60%+）
- **持久化缓存系统**: 24小时缓存机制，大幅减少Git分析时间
- **并行批量分析**: 多线程处理，支持大型仓库高效分析
- **性能监控模块**: 完整的性能统计和调试工具

### 🎯 用户体验优化
- **分层菜单系统**: 6个主分类替代16个选项，降低选择复杂度
- **快速开始向导**: 新用户友好的全流程引导
- **智能状态感知**: 基于当前进度提供操作建议
- **完整组名显示**: 支持长组名的完整显示模式

### 🔧 架构增强
- **DRY架构重构**: 消除代码重复，提升维护性
- **双合并策略**: Legacy快速覆盖 vs Standard三路合并
- **基类抽象化**: 统一接口，易于扩展新策略
- **工厂模式**: 策略切换更加灵活

## 🎯 核心特性

### 🔍 智能分组与分配
- **智能文件分组**: 按目录结构自动分组，每组最多5个文件，避免冲突集中
- **贡献者分析**: 基于Git历史分析文件贡献者，重点关注一年内活跃度
- **自动任务分配**: 优先分配给近期活跃且熟悉相关文件的开发者
- **备选分配策略**: 文件级→目录级→根目录级的层次化分配机制
- **活跃度过滤**: 自动排除近3个月无提交的人员

### 🔄 协作与追踪
- **多人并行**: 支持团队成员同时处理不同文件组
- **进度可视化**: 实时显示分配状态、完成进度和负载分布
- **智能表格显示**: 自动调整列宽，支持完整组名显示模式
- **远程状态检测**: 自动检测远程分支状态，智能推断完成情况
- **批量操作**: 支持按负责人批量合并和状态管理

### 🛠️ 智能合并
- **双合并策略**:
  - **Legacy模式**: 快速覆盖，适合确信源分支内容的场景
  - **Standard模式**: 标准三路合并，产生冲突标记，适合需要精确控制的场景
- **差异化处理**: 区分新文件和已存在文件，采用不同合并策略
- **脚本生成**: 自动生成可执行的bash合并脚本，降低操作复杂度
- **交互式合并**: 处理复杂冲突的交互式工具
- **错误恢复**: 完善的错误处理和回滚机制

## 📁 项目结构

```
git-merge-orchestrator/
├── main.py                              # 主入口文件（优化菜单）
├── git_merge_orchestrator.py            # 主控制器（双策略支持）
├── config.py                            # 配置管理
├── core/                                # 核心业务模块
│   ├── git_operations.py                # Git操作管理
│   ├── contributor_analyzer.py          # 基础贡献者分析
│   ├── optimized_contributor_analyzer.py # 优化版贡献者分析（涡轮增压）
│   ├── task_assigner.py                 # 基础任务分配管理
│   ├── optimized_task_assigner.py       # 优化版任务分配（性能增强）
│   ├── base_merge_executor.py           # 抽象合并执行器基类（DRY架构）
│   ├── legacy_merge_executor.py         # Legacy合并执行器
│   ├── standard_merge_executor.py       # Standard合并执行器
│   ├── merge_executor_factory.py        # 合并执行器工厂
│   └── plan_manager.py                  # 合并计划管理
├── ui/                                  # 用户界面模块
│   ├── display_helper.py                # 显示格式化（智能表格）
│   └── menu_manager.py                  # 分层菜单管理器
├── utils/                               # 工具模块
│   ├── file_helper.py                   # 文件操作工具
│   └── performance_monitor.py           # 性能监控模块
├── test_deployment.py                   # 部署测试脚本
└── README.md                            # 项目说明
```

## 🚀 快速开始

### 环境要求
- Python 3.7+
- Git 2.0+
- 在Git仓库目录下运行

### 基础使用

```bash
# 基础合并（默认每组5个文件）
python main.py feature/big-feature main

# 自定义每组文件数
python main.py feature/big-feature main --max-files 8

# 指定合并策略
python main.py feature/big-feature main --strategy standard

# 指定仓库路径
python main.py feature/big-feature main --repo /path/to/repo

# 查看帮助
python main.py --help
```

### 完整工作流程

#### 🚀 方式1: 快速开始向导（推荐新用户）
1. 启动程序后选择 **1. 快速开始向导**
2. 选择 **a. 全流程引导**
3. 工具将自动完成：分析分叉 → 创建计划 → 分配任务
4. 根据提示进行后续合并操作

#### 📊 方式2: 分步操作（高级用户）

**步骤1: 分析分支分叉**
```
主菜单 → 2. 项目管理 → a. 分析分支分叉
```

**步骤2: 创建智能合并计划**
```
主菜单 → 2. 项目管理 → b. 创建智能合并计划
```

**步骤3: 涡轮增压自动分配任务**
```
主菜单 → 3. 任务分配 → a. 涡轮增压自动分配
- 自动排除近3个月无提交的人员
- 支持手动排除特定人员
- 启用备选分配方案
```

**步骤4: 查看分配结果**
```
主菜单 → 2. 项目管理 → c. 检查项目状态
- a. 标准表格显示（智能列宽调整）
- b. 完整组名显示（无截断显示）
```

**步骤5: 执行合并操作**
```
# 单组合并
主菜单 → 4. 执行合并 → a. 合并指定组

# 批量合并（按负责人）
主菜单 → 4. 执行合并 → b. 合并指定负责人的所有任务

# 交互式合并（处理复杂冲突）
主菜单 → 4. 执行合并 → c. 交互式智能合并
```

**步骤6: 状态管理**
```
主菜单 → 5. 系统管理 → c. 完成状态管理
- 标记组完成
- 自动检查远程分支状态
```

**步骤7: 最终合并**
```
主菜单 → 4. 执行合并 → d. 完成最终合并
```

## 🎯 高级功能

### 🔧 合并策略选择

#### Legacy模式（快速覆盖）
- ⚡ **优势**: 速度快、操作简单、无需手动解决冲突
- 📝 **适合**: 热修复、紧急发布、小团队高信任度项目
- ⚠️ **注意**: 冲突文件直接使用源分支版本覆盖

#### Standard模式（三路合并）
- 🛡️ **优势**: 安全可靠、标准Git流程、支持冲突解决
- 📝 **适合**: 大型项目、多人协作、需要精确控制的场景
- ⚠️ **注意**: 需要手动处理冲突标记 `<<<<<<< ======= >>>>>>>`

```bash
# 切换合并策略
主菜单 → 5. 系统管理 → a. 合并策略管理 → b. 切换合并策略
```

### ⚡ 性能优化特性

#### 涡轮增压自动分配
- 📦 **持久化缓存**: 24小时缓存机制，大幅提升分析速度
- 🔄 **并行分析**: 多线程处理组分析，显著减少等待时间
- 📊 **批量计算**: 一次性分析所有文件，避免重复计算
- 📈 **性能监控**: 实时显示缓存命中率和处理统计

#### 缓存管理
```bash
# 查看缓存状态
主菜单 → 5. 系统管理 → b. 缓存管理 → a. 查看缓存状态

# 清理缓存
主菜单 → 5. 系统管理 → b. 缓存管理 → b. 清理缓存

# 强制重建缓存
主菜单 → 5. 系统管理 → b. 缓存管理 → c. 强制重建缓存
```

### 📊 智能分析功能

#### 贡献者智能分析
```bash
主菜单 → 3. 任务分配 → c. 查看贡献者分析
```

**评分规则**: `一年内提交数 × 3 + 历史总提交数 × 1`

**分配策略**:
- 重点关注近期活跃的开发者
- 自动排除近3个月无提交的人员
- 兼顾历史贡献，避免新人被忽略

#### 分配原因分析
```bash
主菜单 → 2. 项目管理 → d. 查看分配原因分析
```

查看每个组的分配决策过程和推荐理由。

### 🔍 搜索与查询

#### 负责人任务搜索
```bash
主菜单 → 3. 任务分配 → d. 搜索负责人任务
```

输入负责人姓名，查看其分配的所有组和详细信息。

#### 分组详细信息
```bash
主菜单 → 5. 系统管理 → d. 查看分组详细信息
```

查看每个分组的文件列表、贡献者排名和分配详情。

## 🎨 显示优化特性

### 智能表格显示
- **自动列宽调整**: 根据数据内容智能调整表格列宽
- **完整组名显示**: 提供完整组名显示模式，避免长名称截断
- **智能文本截断**: 当文本过长时，智能截断并添加省略号
- **中文字符支持**: 正确计算中文字符显示宽度，确保对齐

### 显示模式选择
**标准表格模式**:
- 紧凑的表格显示，适合概览
- 智能调整列宽，平衡可读性和屏幕空间

**完整组名模式**:
- 完整显示所有组名，无截断
- 详细的分配信息和状态说明
- 适合需要查看具体组名的场景

## 📊 使用场景

### 🏢 企业级开发团队
- 大型feature分支向main分支的合并
- 长期开发分支的定期同步
- 多团队协作的代码集成

### 🔧 开源项目维护
- 复杂PR的分治处理
- 大版本更新的渐进合并
- 贡献者协作管理

### 🚀 DevOps集成
- CI/CD流程中的智能合并
- 自动化分配和追踪
- 合并质量监控

## 🛡️ 安全特性

- **非破坏性操作** - 所有操作在独立分支进行
- **完整回滚机制** - 支持任意阶段的状态回滚
- **冲突预检测** - 提前发现潜在冲突
- **分支保护** - 原始分支始终保持安全

## 📈 性能优化

- **迭代算法** - 避免递归深度问题，处理超大型仓库
- **缓存机制** - 贡献者信息缓存，减少重复计算
- **批量操作** - 支持批量处理，提高操作效率
- **并行处理** - 多线程分析，显著提升性能
- **增量更新** - 只处理变更部分，节省资源

## 🔧 配置选项

### 核心配置
```python
# config.py
DEFAULT_MAX_FILES_PER_GROUP = 5        # 每组最大文件数
DEFAULT_MAX_TASKS_PER_PERSON = 3       # 每人最大任务数
DEFAULT_ACTIVE_MONTHS = 3              # 活跃度判断月数
DEFAULT_ANALYSIS_MONTHS = 12           # 贡献分析月数
```

### 性能配置
```python
CACHE_EXPIRY_HOURS = 24                # 缓存过期时间（小时）
MAX_WORKER_THREADS = 4                 # 最大并行线程数
BATCH_SIZE_THRESHOLD = 10              # 启用批量处理的最小文件数
```

### 显示配置
```python
# 支持自定义表格列宽、对齐方式和显示格式
TABLE_CONFIGS = {
    'status_overview': {
        'headers': ["组名", "文件数", "负责人", "状态", "分配类型", "推荐理由"],
        'widths': [45, 8, 20, 8, 12, 35],
        'aligns': ['left', 'center', 'left', 'center', 'left', 'left']
    }
}
```

## 🐛 故障排除

### 常见问题

**Q: "Git命令执行失败"**
- 检查是否在Git仓库目录下
- 确认分支名称正确
- 检查Git版本是否支持

**Q: "无法确定主要贡献者"**
- 分支可能是全新创建的
- 文件可能没有足够的提交历史
- 启用备选分配方案

**Q: "合并脚本执行失败"**
- 检查文件权限
- 确认源分支和目标分支状态
- 查看生成的脚本内容

**Q: "性能缓慢"**
- 检查缓存状态：主菜单 → 5. 系统管理 → b. 缓存管理
- 尝试清理并重建缓存
- 使用涡轮增压模式进行分配

### 调试模式

```bash
# 启用详细日志
export GIT_MERGE_DEBUG=1
python main.py feature/big-feature main

# 进入调试模式
主菜单 → 6. 高级功能 → d. 调试模式
```

### 部署测试

```bash
# 验证安装和功能完整性
python test_deployment.py
```

## 🤝 参与贡献

欢迎提交Issue和Pull Request！

### 开发指南

1. Fork本仓库
2. 创建feature分支
3. 提交代码变更
4. 确保通过测试
5. 创建Pull Request

### 代码规范

- 使用中文注释和打印输出
- 函数名使用snake_case
- 完善的错误处理
- 丰富的emoji和格式化输出
- 保持DRY原则，避免代码重复

### 架构贡献指南

当前使用DRY架构重构：
- **基类抽象**: 所有合并执行器继承`BaseMergeExecutor`
- **工厂模式**: 通过`MergeExecutorFactory`管理策略切换
- **策略模式**: Legacy和Standard策略实现不同的合并逻辑
- **性能优化**: 优化版组件提供高性能实现

添加新合并策略时：
1. 继承`BaseMergeExecutor`基类
2. 实现抽象方法：`generate_merge_script`等
3. 在工厂类中注册新策略
4. 添加相应的配置和文档

## 📄 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 👥 作者

- **Howie** - 项目创建者和主要维护者

## 🙏 致谢

感谢所有使用本工具并提供反馈的开发者！

## 📚 相关链接

- [项目主页](https://github.com/hoastyle/git-merge-orchestrator)
- [问题反馈](https://github.com/hoastyle/git-merge-orchestrator/issues)
- [功能建议](https://github.com/hoastyle/git-merge-orchestrator/discussions)

---

**⭐ 如果这个工具对你有帮助，请给个星星支持一下！**

## 🎯 版本规划

### 当前版本 2.0 (DRY架构重构版)
- ✅ DRY架构重构完成
- ✅ 双合并策略支持
- ✅ 性能优化完成
- ✅ 分层菜单优化

### 计划版本 2.1 (智能增强版)
- 🔄 机器学习优化分配算法
- 🔄 Web界面支持
- 🔄 REST API接口
- 🔄 插件系统架构

### 计划版本 2.2 (生态集成版)
- 🔄 GitLab/GitHub集成
- 🔄 Slack/Teams通知
- 🔄 JIRA集成
- 🔄 CI/CD Pipeline集成

## 📊 性能指标

### 涡轮增压模式性能提升
- 🚀 **分析速度**: 提升60%+（缓存命中时）
- ⚡ **内存使用**: 优化40%（批量处理）
- 📈 **并发处理**: 支持4线程并行分析
- 💾 **缓存效率**: 24小时持久化，命中率90%+

### 支持规模
- 📁 **文件数量**: 支持10,000+文件的大型分叉
- 👥 **贡献者数**: 支持1,000+贡献者分析
- 🌳 **分支历史**: 支持5年+历史分析
- 📊 **分组数量**: 支持2,000+分组管理
