# Git Merge Orchestrator 2.2

🚀 **智能Git大分叉分步合并工具** - 文件级处理架构升级版

一个专门解决大型分支分叉协作合并问题的智能工具。通过文件级精确分析、智能任务分配和高级查询系统，将复杂的合并工作转化为可管理的团队协作流程。

**当前版本**: v2.2 (生产就绪) | **更新时间**: 2025-08-07

## ✨ v2.2 架构升级特性

### 🎯 文件级精确处理
- **文件级分析分配**: 完全移除组级策略，实现文件级精确分析和分配
- **精确状态跟踪**: 文件级状态管理 (pending, assigned, in_progress, completed)
- **负载均衡优化**: 智能的文件级负载均衡算法
- **处理模式选择**: 支持 `file_level` 和 `group_based` 模式切换

### 🔍 高级查询系统
- **多维度查询**: 按人员、文件、状态、目录的复杂查询
- **模糊匹配支持**: 使用 difflib 和正则表达式实现智能匹配
- **反向查询**: 根据条件反向查找相关项目
- **组合查询**: 支持复杂的查询条件组合

### 🚫 智能忽略系统
- **`.merge_ignore` 支持**: 类似 .gitignore 的忽略规则配置
- **多种匹配模式**: glob、regex、精确匹配、前缀、后缀
- **智能过滤**: 自动排除编译文件、日志、临时文件等
- **实时统计**: 显示过滤的文件数量和类型

### 🎛️ 优化的默认体验
- **Legacy 默认策略**: 默认使用 legacy 策略，提供更快的合并体验
- **文件级 UI**: 全新的文件级视图和操作界面
- **完善的测试环境**: 独立的 git-merge-orchestrator-test 测试目录

## ✨ v2.0-2.1 历史特性

### 🚀 性能优化
- **涡轮增压自动分配**: 显著提升任务分配速度（提升60%+）
- **持久化缓存系统**: 24小时缓存机制，大幅减少Git分析时间
- **并行批量分析**: 多线程处理，支持大型仓库高效分析
- **性能监控模块**: 完整的性能统计和调试工具

### 🎯 用户体验优化
- **分层菜单系统**: 6个主分类替代16个选项，降低选择复杂度
- **快速开始向导**: 新用户友好的全流程引导
- **智能状态感知**: 基于当前进度提供操作建议
- **完整组名显示**: 支持长组名的完整显示模式

### 🔧 架构增强
- **DRY架构重构**: 消除代码重复，提升维护性
- **双合并策略**: Legacy快速覆盖 vs Standard三路合并
- **基类抽象化**: 统一接口，易于扩展新策略
- **工厂模式**: 策略切换更加灵活

## 🎯 核心特性

### 🔍 智能分组与分配
- **智能文件分组**: 按目录结构自动分组，每组最多5个文件，避免冲突集中
- **贡献者分析**: 基于Git历史分析文件贡献者，重点关注一年内活跃度
- **自动任务分配**: 优先分配给近期活跃且熟悉相关文件的开发者
- **备选分配策略**: 文件级→目录级→根目录级的层次化分配机制
- **活跃度过滤**: 自动排除近3个月无提交的人员

### 🔄 协作与追踪
- **多人并行**: 支持团队成员同时处理不同文件组
- **进度可视化**: 实时显示分配状态、完成进度和负载分布
- **智能表格显示**: 自动调整列宽，支持完整组名显示模式
- **远程状态检测**: 自动检测远程分支状态，智能推断完成情况
- **批量操作**: 支持按负责人批量合并和状态管理

### 🛠️ 智能合并
- **双合并策略**:
  - **Legacy模式**: 快速覆盖，适合确信源分支内容的场景
  - **Standard模式**: 标准三路合并，产生冲突标记，适合需要精确控制的场景
- **差异化处理**: 区分新文件和已存在文件，采用不同合并策略
- **脚本生成**: 自动生成可执行的bash合并脚本，降低操作复杂度
- **交互式合并**: 处理复杂冲突的交互式工具
- **错误恢复**: 完善的错误处理和回滚机制

## 📁 项目结构

```
git-merge-orchestrator/
├── main.py                              # 主入口文件（配置增强版）
├── git_merge_orchestrator.py            # 主控制器（文件级处理支持）
├── config.py                            # 配置管理（文件级表格配置）
├── core/                                # 核心业务模块
│   ├── git_operations.py                # Git操作管理（文件级方法）
│   ├── contributor_analyzer.py          # 基础贡献者分析
│   ├── optimized_contributor_analyzer.py # 优化版贡献者分析（涡轮增压）
│   ├── task_assigner.py                 # 基础任务分配管理
│   ├── optimized_task_assigner.py       # 优化版任务分配（文件级支持）
│   ├── base_merge_executor.py           # 抽象合并执行器基类（文件级抽象）
│   ├── legacy_merge_executor.py         # Legacy合并执行器（文件级实现）
│   ├── standard_merge_executor.py       # Standard合并执行器（文件级实现）
│   ├── merge_executor_factory.py        # 合并执行器工厂（默认legacy）
│   ├── plan_manager.py                  # 合并计划管理
│   └── query_system.py                  # 🆕 高级查询系统
├── ui/                                  # 用户界面模块
│   ├── display_helper.py                # 显示格式化（文件级视图支持）
│   └── menu_manager.py                  # 分层菜单管理器（文件级菜单）
├── utils/                               # 工具模块
│   ├── file_helper.py                   # 文件操作工具（文件级支持）
│   ├── performance_monitor.py           # 性能监控模块
│   ├── config_manager.py               # 项目配置管理器
│   └── ignore_manager.py               # 🆕 智能忽略规则管理器
├── tests/                               # 测试模块
│   ├── comprehensive_test.py            # 综合测试套件
│   ├── run_tests.py                     # 统一测试运行器
│   └── TESTING.md                       # 测试体系说明
├── CLAUDE.md                            # Claude Code 项目指南
├── TODO.md                              # 📝 任务状态（已完成）
├── PROJECT_STATUS.md                    # 📊 项目状态摘要
├── CHANGELOG.md                         # 🆕 版本更新日志
├── TESTING_GUIDE.md                     # 🧪 测试环境指南
└── README.md                            # 项目说明
```

### 🧪 测试环境

```
../git-merge-orchestrator-test/         # 🆕 独立测试环境
├── README.md                            # 测试使用指南
├── test-scripts/                        # 测试工具脚本
│   ├── create_test_repo.py              # 测试仓库创建工具
│   ├── setup_scenarios.py              # 测试场景设置
│   ├── cleanup.py                       # 清理管理工具
│   └── test_data_generator.py           # 测试数据生成器
├── test-repos/                          # 测试仓库目录
├── test-data/                           # 测试数据
└── scenarios/                           # 测试场景配置
```

## 🚀 快速开始

### 环境要求
- Python 3.7+
- Git 2.0+
- 在Git仓库目录下运行

### 基础使用

```bash
# v2.2 扁平化菜单 + 文件级处理（默认）
python main.py feature/big-feature main

# 显式指定文件级处理
python main.py feature/big-feature main --processing-mode file_level

# 使用传统组模式（向后兼容）
python main.py feature/big-feature main --processing-mode group_based --max-files 8

# 指定合并策略（默认 legacy）
python main.py feature/big-feature main --strategy standard

# 指定仓库路径
python main.py feature/big-feature main --repo /path/to/repo

# 配置忽略规则
echo "*.pyc" > .merge_ignore
echo "*.log" >> .merge_ignore
python main.py feature/big-feature main

# 查看帮助
python main.py --help
```

### 🎯 扁平化菜单系统

```bash
python main.py feature/big-feature main
```
- **1级菜单**: 直接输入数字1-12访问所有功能
- **操作效率**: 1-2步完成操作，快速高效
- **智能提示**: 根据项目状态提供操作建议
- **快捷键支持**: q(退出)、h(帮助)、s(状态)

### 完整工作流程

#### 🚀 方式1: 快速全流程（推荐新用户）
```bash
python main.py feature/big-feature main
```

1. **输入 `1`** - 快速全流程（新用户推荐）
   - 自动完成：分析分叉 → 创建计划 → 分配任务
2. **输入 `5`** - 查看项目状态
3. **输入 `8`** - 按组合并，或 **输入 `9`** - 批量合并
4. **输入 `10`** - 完成最终合并

#### 📊 方式2: 分步操作（高级用户）
1. **输入 `2`** - 分析分支分叉
2. **输入 `3`** - 创建智能合并计划  
3. **输入 `4`** - 自动分配任务
4. **输入 `5`** - 检查项目状态
5. **输入 `8-9`** - 执行合并操作
6. **输入 `10`** - 完成最终合并


## 🎯 高级功能

### 🔧 合并策略选择

#### Legacy模式（快速覆盖）
- ⚡ **优势**: 速度快、操作简单、无需手动解决冲突
- 📝 **适合**: 热修复、紧急发布、小团队高信任度项目
- ⚠️ **注意**: 冲突文件直接使用源分支版本覆盖

#### Standard模式（三路合并）
- 🛡️ **优势**: 安全可靠、标准Git流程、支持冲突解决
- 📝 **适合**: 大型项目、多人协作、需要精确控制的场景
- ⚠️ **注意**: 需要手动处理冲突标记 `<<<<<<< ======= >>>>>>>`

```bash
# 切换合并策略
输入 11 (系统设置) → a (切换合并策略)
```

### ⚡ 性能优化特性

#### 涡轮增压自动分配
- 📦 **持久化缓存**: 24小时缓存机制，大幅提升分析速度
- 🔄 **并行分析**: 多线程处理组分析，显著减少等待时间
- 📊 **批量计算**: 一次性分析所有文件，避免重复计算
- 📈 **性能监控**: 实时显示缓存命中率和处理统计

#### 缓存管理
```bash
# 系统设置
输入 11 → c (查看性能统计) 
输入 11 → d (清理缓存)
```

### 📊 智能分析功能

#### 贡献者智能分析
```bash
输入 6 (高级查询) → 查看分析结果
```

**评分规则**: `一年内提交数 × 3 + 历史总提交数 × 1`

**分配策略**:
- 重点关注近期活跃的开发者
- 自动排除近3个月无提交的人员
- 兼顾历史贡献，避免新人被忽略

### 🔍 搜索与查询

```bash
输入 6 (高级查询) - 多维度查询功能
输入 7 (搜索/分配任务) - 任务管理和搜索
```

- 按负责人查询分配的任务
- 按文件路径搜索相关信息
- 按状态查询项目进度
- 手动分配特定任务

## 🎨 显示优化特性

### 智能表格显示
- **自动列宽调整**: 根据数据内容智能调整表格列宽
- **完整组名显示**: 提供完整组名显示模式，避免长名称截断
- **智能文本截断**: 当文本过长时，智能截断并添加省略号
- **中文字符支持**: 正确计算中文字符显示宽度，确保对齐

### 显示模式选择
**标准表格模式**:
- 紧凑的表格显示，适合概览
- 智能调整列宽，平衡可读性和屏幕空间

**完整组名模式**:
- 完整显示所有组名，无截断
- 详细的分配信息和状态说明
- 适合需要查看具体组名的场景

## 📊 使用场景

### 🏢 企业级开发团队
- 大型feature分支向main分支的合并
- 长期开发分支的定期同步
- 多团队协作的代码集成

### 🔧 开源项目维护
- 复杂PR的分治处理
- 大版本更新的渐进合并
- 贡献者协作管理

### 🚀 DevOps集成
- CI/CD流程中的智能合并
- 自动化分配和追踪
- 合并质量监控

## 🛡️ 安全特性

- **非破坏性操作** - 所有操作在独立分支进行
- **完整回滚机制** - 支持任意阶段的状态回滚
- **冲突预检测** - 提前发现潜在冲突
- **分支保护** - 原始分支始终保持安全

## 📈 性能优化

- **迭代算法** - 避免递归深度问题，处理超大型仓库
- **缓存机制** - 贡献者信息缓存，减少重复计算
- **批量操作** - 支持批量处理，提高操作效率
- **并行处理** - 多线程分析，显著提升性能
- **增量更新** - 只处理变更部分，节省资源

## 🔧 配置选项

### 核心配置
```python
# config.py
DEFAULT_MAX_FILES_PER_GROUP = 5        # 每组最大文件数
DEFAULT_MAX_TASKS_PER_PERSON = 3       # 每人最大任务数
DEFAULT_ACTIVE_MONTHS = 3              # 活跃度判断月数
DEFAULT_ANALYSIS_MONTHS = 12           # 贡献分析月数
```

### 性能配置
```python
CACHE_EXPIRY_HOURS = 24                # 缓存过期时间（小时）
MAX_WORKER_THREADS = 4                 # 最大并行线程数
BATCH_SIZE_THRESHOLD = 10              # 启用批量处理的最小文件数
```

### 显示配置
```python
# 支持自定义表格列宽、对齐方式和显示格式
TABLE_CONFIGS = {
    'status_overview': {
        'headers': ["组名", "文件数", "负责人", "状态", "分配类型", "推荐理由"],
        'widths': [45, 8, 20, 8, 12, 35],
        'aligns': ['left', 'center', 'left', 'center', 'left', 'left']
    }
}
```

## 🐛 故障排除

### 常见问题

**Q: "Git命令执行失败"**
- 检查是否在Git仓库目录下
- 确认分支名称正确
- 检查Git版本是否支持

**Q: "无法确定主要贡献者"**
- 分支可能是全新创建的
- 文件可能没有足够的提交历史
- 启用备选分配方案

**Q: "合并脚本执行失败"**
- 检查文件权限
- 确认源分支和目标分支状态
- 查看生成的脚本内容

**Q: "性能缓慢"**
- 检查缓存状态：输入 11 → c (查看性能统计)
- 尝试清理并重建缓存：输入 11 → d (清理缓存)
- 使用涡轮增压模式进行分配

### 调试模式

```bash
# 启用详细日志
export GIT_MERGE_DEBUG=1
python main.py feature/big-feature main

# 进入系统设置查看详细信息
输入 11 (系统设置) → c (查看性能统计)
```

### 部署测试

```bash
# 验证安装和功能完整性
python test_deployment.py
```

## 🤝 参与贡献

欢迎提交Issue和Pull Request！

### 开发指南

1. Fork本仓库
2. 创建feature分支
3. 提交代码变更
4. 确保通过测试
5. 创建Pull Request

### 代码规范

- 使用中文注释和打印输出
- 函数名使用snake_case
- 完善的错误处理
- 丰富的emoji和格式化输出
- 保持DRY原则，避免代码重复

### 架构贡献指南

当前使用DRY架构重构：
- **基类抽象**: 所有合并执行器继承`BaseMergeExecutor`
- **工厂模式**: 通过`MergeExecutorFactory`管理策略切换
- **策略模式**: Legacy和Standard策略实现不同的合并逻辑
- **性能优化**: 优化版组件提供高性能实现

添加新合并策略时：
1. 继承`BaseMergeExecutor`基类
2. 实现抽象方法：`generate_merge_script`等
3. 在工厂类中注册新策略
4. 添加相应的配置和文档

## 📄 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 👥 作者

- **Howie** - 项目创建者和主要维护者

## 🙏 致谢

感谢所有使用本工具并提供反馈的开发者！

## 📚 相关链接

- [项目主页](https://github.com/hoastyle/git-merge-orchestrator)
- [问题反馈](https://github.com/hoastyle/git-merge-orchestrator/issues)
- [功能建议](https://github.com/hoastyle/git-merge-orchestrator/discussions)

---

**⭐ 如果这个工具对你有帮助，请给个星星支持一下！**

## 🎯 版本规划

### 当前版本 2.0 (DRY架构重构版)
- ✅ DRY架构重构完成
- ✅ 双合并策略支持
- ✅ 性能优化完成
- ✅ 分层菜单优化

### 计划版本 2.1 (智能增强版)
- 🔄 机器学习优化分配算法
- 🔄 Web界面支持
- 🔄 REST API接口
- 🔄 插件系统架构

### 计划版本 2.2 (生态集成版)
- 🔄 GitLab/GitHub集成
- 🔄 Slack/Teams通知
- 🔄 JIRA集成
- 🔄 CI/CD Pipeline集成

## 📊 性能指标

### 涡轮增压模式性能提升
- 🚀 **分析速度**: 提升60%+（缓存命中时）
- ⚡ **内存使用**: 优化40%（批量处理）
- 📈 **并发处理**: 支持4线程并行分析
- 💾 **缓存效率**: 24小时持久化，命中率90%+

### 支持规模
- 📁 **文件数量**: 支持10,000+文件的大型分叉
- 👥 **贡献者数**: 支持1,000+贡献者分析
- 🌳 **分支历史**: 支持5年+历史分析
- 📊 **分组数量**: 支持2,000+分组管理
